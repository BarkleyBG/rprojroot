---
title: "Finding files reliably"
author: "Kirill MÃ¼ller"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Finding files reliably}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

The `rprojroot` package solves a seemingly trivial but annoying problem
that occurs sooner or later
in any largish project:
How to find files in subdirectories?
Relative file paths are almost always preferable to absolute paths,
but relative to what should they be?
Unfortunately, we cannot always be sure about the value of the working directory:
For instance, in RStudio,
sometimes it's the project root (when running R scripts),
sometimes a subdirectory (when building vignettes),
sometimes again the project root (when executing chunks of a vignette):

```{r}
basename(getwd())
```

If we could only get hold of our...


## Project root

The *root* of a project is defined as a directory that contains a regular file
whose name matches a given pattern and whose contents optionally match
another pattern.
Thus, the following method reliably finds our project root:

- Start the search in any subdirectory of our project
- Proceed up the directory hierarchy until finding a file that matches
the criteria

The Git version control system (and probably many other tools) use a similar
approach: A Git command can be executed from within any subdirectory of a
repository.


## A simple example

Note that the following code produces identical results when building the
vignette *and* when sourcing the chunk, provided that the project root is the current working directory or a parent thereof:

```{r}
library(rprojroot)
basename(find_root("DESCRIPTION"))
file.exists(find_root_file("R", "root.R", filename = "DESCRIPTION"))
```


## Practical use

You can save some time for RStudio projects and packages:

```{r}
print(find_package_root_file)
head(readLines(find_package_root_file("vignettes", "rprojroot.Rmd")))
```

If you're lazy, define a shortcut:

```{r}
P <- find_package_root_file
file.exists(P("vignettes", "rprojroot.Rmd"))
```

Legacy code can benefit immediately if the `file.path` function is overwritten.

You might also want to define your project root differently
(this fails here -- we look for a file named `LICENSE` which is absent):

```{r}
R <- make_find_root_file(glob2rx("LICENSE"))
R
class(try(dir.exists(R("man"))))
```


## Summary

The `rprojroot` allows easy access to files below a project root
which is supposed to be the only directory in the whole hierarchy that contains
a specific file.
This is a robust solution for finding project files in largish projects
with a subdirectory hierarchy if the current working directory cannot be assumed
fixed (but can be assumed to be somewhere below the project root).


## Acknowledgement

This package was inspired by the
["Stop working directory insanity"](https://gist.github.com/jennybc/362f52446fe1ebc4c49f)
gist by Jennifer Bryan.

